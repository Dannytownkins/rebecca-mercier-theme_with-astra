name: Deploy WordPress Theme

on:
  push:
    branches:
      - main
      - master
  workflow_dispatch:

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js (if needed for build)
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Create deployment package
        run: |
          # Create a clean build directory
          mkdir -p build

          # Copy theme files, excluding dev files
          rsync -av --exclude='.git' \
                    --exclude='.github' \
                    --exclude='node_modules' \
                    --exclude='.gitignore' \
                    --exclude='.gitattributes' \
                    --exclude='*.zip' \
                    --exclude='build' \
                    ./ build/rebecca-mercier-theme/

          # Create ZIP file
          cd build
          zip -r rebecca-mercier-theme.zip rebecca-mercier-theme/
          cd ..

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: rebecca-mercier-theme
          path: build/rebecca-mercier-theme.zip
          retention-days: 30

      # Optional: Deploy via FTP
      # Uncomment and configure secrets in GitHub repository settings
      # - name: Deploy to server via FTP
      #   uses: SamKirkland/FTP-Deploy-Action@v4.3.5
      #   with:
      #     server: ${{ secrets.FTP_SERVER }}
      #     username: ${{ secrets.FTP_USERNAME }}
      #     password: ${{ secrets.FTP_PASSWORD }}
      #     server-dir: /wp-content/themes/rebecca-mercier-theme/
      #     local-dir: ./build/rebecca-mercier-theme/

      # Optional: Create GitHub release
      # - name: Create Release
      #   if: startsWith(github.ref, 'refs/tags/')
      #   uses: softprops/action-gh-release@v1
      #   with:
      #     files: build/rebecca-mercier-theme.zip
      #   env:
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
